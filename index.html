<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Schach - A full-featured web-based chess game">
    <title>Schach - Chess Game</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/board.css">
    <link rel="stylesheet" href="css/auth.css">
    <link rel="stylesheet" href="css/roguelike.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- get font awesome icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <span class="logo-icon">‚ôî</span>
                    <h1>Schach</h1>
                </div>
                <nav class="nav">
                    <button class="nav-btn active" data-view="play">Play</button>
                    <button class="nav-btn" data-view="learn">Learn</button>
                    <button class="nav-btn" data-view="puzzles">Puzzles</button>
                </nav>
                <div class="user-menu" id="userMenu">
                    <!-- Guest state (default) -->
                    <div class="auth-buttons" id="authButtons">
                        <button class="btn btn-outline" id="loginBtn">Login</button>
                        <button class="btn btn-primary" id="registerBtn">Register</button>
                    </div>
                    <!-- Logged in state (hidden by default) -->
                    <div class="user-info" id="userInfo" style="display: none;">
                        <div class="user-avatar" id="userAvatar">üë§</div>
                        <div class="user-details">
                            <span class="username" id="headerUsername">Username</span>
                            <span class="user-rating" id="headerRating">ELO: 1200</span>
                        </div>
                        <div class="dropdown" id="userDropdown">
                            <button class="dropdown-btn" id="userDropdownBtn">‚ñº</button>
                            <div class="dropdown-menu" id="userDropdownMenu">
                                <a href="profile.html" class="dropdown-item" id="profileBtn">
                                    <span class="dropdown-icon">üë§</span> Profile
                                </a>
                                <a href="#" class="dropdown-item" id="settingsBtn">
                                    <span class="dropdown-icon">‚öôÔ∏è</span> Settings
                                </a>
                                <div class="dropdown-divider"></div>
                                <a href="#" class="dropdown-item" id="logoutBtn">
                                    <span class="dropdown-icon">üö™</span> Logout
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Game Selection Panel -->
            <aside class="sidebar left-sidebar">
                <div class="panel">
                    <h3>New Game</h3>
                    <div class="game-options">
                        <button class="option-btn active" id="vsAiBtn">
                            <span class="option-icon">ü§ñ</span>
                            <span class="option-text">vs Computer</span>
                        </button>
                        <button class="option-btn" id="vsPlayerLocalBtn">
                            <span class="option-icon">üë•</span>
                            <span class="option-text">Local 2P</span>
                        </button>
                        <button class="option-btn" id="vsPlayerOnlineBtn">
                            <span class="option-icon">üåê</span>
                            <span class="option-text">Online</span>
                        </button>
                        <button class="option-btn roguelike-btn" id="roguelikeBtn">
                            <span class="option-icon">‚öîÔ∏è</span>
                            <span class="option-text">Roguelike</span>
                            <span class="beta-badge">BETA</span>
                        </button>
                    </div>
                </div>

                <div class="panel" id="aiOptionsPanel">
                    <h3>AI Difficulty</h3>
                    <div class="difficulty-options">
                        <label class="radio-option">
                            <input type="radio" name="difficulty" value="easy" checked>
                            <span class="radio-label">Easy</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="difficulty" value="medium">
                            <span class="radio-label">Medium</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="difficulty" value="hard">
                            <span class="radio-label">Hard</span>
                        </label>
                    </div>
                </div>

                <div class="panel">
                    <h3>Play As</h3>
                    <div class="color-selection">
                        <button class="color-btn active" data-color="white">
                            <span class="piece-white">‚ôî</span> White
                        </button>
                        <button class="color-btn" data-color="random">
                            <span>üé≤</span> Random
                        </button>
                        <button class="color-btn" data-color="black">
                            <span class="piece-black">‚ôö</span> Black
                        </button>
                    </div>
                </div>

                <button class="btn btn-primary btn-large" id="startGameBtn">Start Game</button>
            </aside>

            <!-- Chess Board Area -->
            <section class="game-area">
                <div class="player-info top">
                    <div class="player-avatar" id="opponentAvatar">ü§ñ</div>
                    <div class="player-details">
                        <span class="player-name" id="opponentName">Computer</span>
                        <span class="player-rating" id="opponentRating">Level: Easy</span>
                    </div>
                    <div class="ai-thinking" id="aiThinking" style="display: none;">
                        <div class="thinking-dots">
                            <span></span><span></span><span></span>
                        </div>
                        <span class="thinking-text">Thinking...</span>
                    </div>
                    <div class="player-timer" id="blackTimer">10:00</div>
                </div>

                <div class="board-wrapper">
                    <div class="board-container">
                        <!-- Chess Board -->
                        <div class="chessboard" id="chessboard">
                            <!-- Board squares will be generated by JavaScript -->
                        </div>
                    </div>
                </div>

                <div class="player-info bottom">
                    <div class="player-avatar">üë§</div>
                    <div class="player-details">
                        <span class="player-name">You</span>
                        <span class="player-rating">Guest</span>
                    </div>
                    <div class="player-timer" id="whiteTimer">10:00</div>
                </div>

                <!-- Game Controls -->
                <div class="game-controls">
                    <button class="control-btn" id="flipBoardBtn" title="Flip Board">
                        <i class="fa-solid fa-rotate"></i>
                    </button>
                    <button class="control-btn" id="undoBtn" title="Undo Move" disabled>
                        <i class="fa-solid fa-rotate-left"></i>
                    </button>
                    <button class="control-btn" id="redoBtn" title="Redo Move" disabled>
                        <i class="fa-solid fa-rotate-right"></i>
                    </button>
                    <button class="control-btn" id="hintBtn" title="Get Hint" disabled>
                        <i class="fa-solid fa-lightbulb"></i>
                    </button>
                    <button class="control-btn" id="resignBtn" title="Resign" disabled>
                        <i class="fa-solid fa-flag"></i>
                    </button>
                    <button class="control-btn" id="drawBtn" title="Offer Draw" disabled>
                        <i class="fa-solid fa-handshake"></i>
                    </button>
                </div>
            </section>

            <!-- Move History & Info Panel -->
            <aside class="sidebar right-sidebar">
                <div class="panel">
                    <h3>Game Status</h3>
                    <div class="game-status" id="gameStatus">
                        <p>Click "Start Game" to begin</p>
                    </div>
                </div>

                <div class="panel">
                    <h3>Move History</h3>
                    <div class="move-history" id="moveHistory">
                        <div class="move-list">
                            <!-- Moves will be added here -->
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <h3>Captured Pieces</h3>
                    <div class="captured-pieces">
                        <div class="captured-white" id="capturedWhite"></div>
                        <div class="captured-black" id="capturedBlack"></div>
                    </div>
                </div>
            </aside>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>&copy; 2024 Schach Chess Game. All rights reserved.</p>
        </footer>
    </div>

    <!-- Pawn Promotion Modal -->
    <div class="modal" id="promotionModal">
        <div class="modal-content promotion-modal">
            <button class="modal-close" id="promotionModalClose">&times;</button>
            <h3>Choose Promotion</h3>
            <div class="promotion-options" id="promotionOptions">
                <!-- Options will be set by JavaScript based on color -->
            </div>
        </div>
    </div>

    <!-- Game Over Modal -->
    <div class="modal" id="gameOverModal">
        <div class="modal-content">
            <button class="modal-close" id="gameOverModalClose">&times;</button>
            <h2 id="gameOverTitle">Game Over</h2>
            <p id="gameOverMessage"></p>
            <div class="modal-actions">
                <button class="btn btn-primary" id="newGameBtn">New Game</button>
                <button class="btn btn-outline" id="reviewGameBtn">Review Game</button>
            </div>
        </div>
    </div>

    <!-- Draw Offer Modal -->
    <div class="modal" id="drawOfferModal">
        <div class="modal-content">
            <button class="modal-close" id="drawOfferModalClose">&times;</button>
            <h2>Draw Offered</h2>
            <p id="drawOfferMessage">Your opponent has offered a draw. Do you accept?</p>
            <div class="modal-actions">
                <button class="btn btn-primary" id="acceptDrawBtn">Accept Draw</button>
                <button class="btn btn-outline" id="declineDrawBtn">Decline</button>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content auth-modal">
            <button class="modal-close" id="loginModalClose">&times;</button>
            <h2>Login to Schach</h2>
            <form id="loginForm" class="auth-form">
                <div class="form-group">
                    <label for="loginIdentifier">Username or Email</label>
                    <input type="text" id="loginIdentifier" name="identifier" required 
                           placeholder="Enter username or email">
                    <span class="error-message" id="loginIdentifierError"></span>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" name="password" required 
                           placeholder="Enter password">
                    <span class="error-message" id="loginPasswordError"></span>
                </div>
                <div class="form-group checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="rememberMe" name="remember_me">
                        <span>Remember me</span>
                    </label>
                </div>
                <span class="error-message general-error" id="loginGeneralError"></span>
                <button type="submit" class="btn btn-primary btn-block" id="loginSubmitBtn">
                    Login
                </button>
            </form>
            <div class="auth-footer">
                <p>Don't have an account? <a href="#" id="switchToRegister">Register here</a></p>
                <p><a href="#" id="forgotPasswordLink">Forgot password?</a></p>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div class="modal" id="registerModal">
        <div class="modal-content auth-modal">
            <button class="modal-close" id="registerModalClose">&times;</button>
            <h2>Create Account</h2>
            <form id="registerForm" class="auth-form">
                <div class="form-group">
                    <label for="registerUsername">Username</label>
                    <input type="text" id="registerUsername" name="username" required 
                           placeholder="Choose a username" minlength="3" maxlength="20">
                    <span class="error-message" id="registerUsernameError"></span>
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" name="email" required 
                           placeholder="Enter your email">
                    <span class="error-message" id="registerEmailError"></span>
                </div>
                <div class="form-group">
                    <label for="registerPassword">Password</label>
                    <input type="password" id="registerPassword" name="password" required 
                           placeholder="Create a password" minlength="8">
                    <span class="error-message" id="registerPasswordError"></span>
                    <div class="password-requirements">
                        <small>Must be at least 8 characters with uppercase, lowercase, and a number</small>
                    </div>
                </div>
                <div class="form-group">
                    <label for="registerConfirmPassword">Confirm Password</label>
                    <input type="password" id="registerConfirmPassword" name="confirm_password" required 
                           placeholder="Confirm your password">
                    <span class="error-message" id="registerConfirmPasswordError"></span>
                </div>
                <span class="error-message general-error" id="registerGeneralError"></span>
                <button type="submit" class="btn btn-primary btn-block" id="registerSubmitBtn">
                    Create Account
                </button>
            </form>
            <div class="auth-footer">
                <p>Already have an account? <a href="#" id="switchToLogin">Login here</a></p>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="modal" id="editProfileModal">
        <div class="modal-content auth-modal">
            <button class="modal-close" id="editProfileModalClose">&times;</button>
            <h2>Edit Profile</h2>
            <form id="editProfileForm" class="auth-form">
                <div class="form-group">
                    <label for="editEmail">Email</label>
                    <input type="email" id="editEmail" name="email" 
                           placeholder="Enter new email">
                    <span class="error-message" id="editEmailError"></span>
                </div>
                <span class="error-message general-error" id="editProfileGeneralError"></span>
                <button type="submit" class="btn btn-primary btn-block">Save Changes</button>
            </form>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div class="modal" id="changePasswordModal">
        <div class="modal-content auth-modal">
            <button class="modal-close" id="changePasswordModalClose">&times;</button>
            <h2>Change Password</h2>
            <form id="changePasswordForm" class="auth-form">
                <div class="form-group">
                    <label for="currentPassword">Current Password</label>
                    <input type="password" id="currentPassword" name="current_password" required 
                           placeholder="Enter current password">
                    <span class="error-message" id="currentPasswordError"></span>
                </div>
                <div class="form-group">
                    <label for="newPassword">New Password</label>
                    <input type="password" id="newPassword" name="new_password" required 
                           placeholder="Enter new password" minlength="8">
                    <span class="error-message" id="newPasswordError"></span>
                </div>
                <div class="form-group">
                    <label for="confirmNewPassword">Confirm New Password</label>
                    <input type="password" id="confirmNewPassword" name="confirm_password" required 
                           placeholder="Confirm new password">
                    <span class="error-message" id="confirmNewPasswordError"></span>
                </div>
                <span class="error-message general-error" id="changePasswordGeneralError"></span>
                <button type="submit" class="btn btn-primary btn-block">Change Password</button>
            </form>
        </div>
    </div>

    <!-- Roguelike Upgrade Selection Modal -->
    <div class="modal" id="upgradeModal">
        <div class="modal-content upgrade-modal-content">
            <h2>‚öîÔ∏è Choose Your Reward</h2>
            <p class="upgrade-subtitle">Select one upgrade to enhance your chess pieces</p>
            <div class="upgrade-options" id="upgradeOptions">
                <!-- Dynamically populated with upgrade cards -->
            </div>
            <p class="upgrade-hint">üí° Tip: Upgrades stack! Multiple pawns can have Schildtr√§ger.</p>
        </div>
    </div>

    <!-- Roguelike HUD (initially hidden) -->
    <aside class="roguelike-hud" id="roguelikeHUD" style="display: none;">
        <div class="hud-section run-progress">
            <h3>üìç Progress</h3>
            <div class="progress-info">
                <div class="progress-item">
                    <span class="label">Zone:</span>
                    <span class="value"><strong id="currentZone">1</strong> / 5</span>
                </div>
                <div class="progress-item">
                    <span class="label">Battle:</span>
                    <span class="value"><strong id="currentEncounter">1</strong> / 3</span>
                </div>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar" id="runProgressBar" style="width: 0%"></div>
            </div>
        </div>
        
        <div class="hud-section resources">
            <h3>üí∞ Gold</h3>
            <div class="gold-display">
                <span class="gold-amount" id="goldAmount">0</span>
            </div>
        </div>
        
        <div class="hud-section active-upgrades">
            <h3>‚¨ÜÔ∏è Active Upgrades</h3>
            <div class="upgrade-list" id="activeUpgradeList">
                <p class="empty-state">No upgrades yet</p>
            </div>
        </div>
        
        <div class="hud-section artifacts">
            <h3>‚ú® Artifacts</h3>
            <div class="artifact-list" id="artifactList">
                <p class="empty-state">No artifacts yet</p>
            </div>
        </div>
    </aside>

    <!-- Scripts -->
    <script src="js/constants.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/pieces.js"></script>
    <script src="js/board.js"></script>
    <script src="js/game.js"></script>
    <script src="js/ai.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/timer.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/gameApi.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
